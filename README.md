#  SpringBoot3 + Web3j + Ganache åŒºå—é“¾æº¯æº Demo

[![GitHub stars](https://img.shields.io/github/stars/linyshdhhcb/blockchain-traceability-demo?style=social)](https://github.com/linyshdhhcb/blockchain-traceability-demo/stargazers)
[![GitHub forks](https://img.shields.io/github/forks/linyshdhhcb/blockchain-traceability-demo?style=social)](https://github.com/linyshdhhcb/blockchain-traceability-demo/fork)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

ä¸€ä¸ªç®€å•çš„åŒºå—é“¾æº¯æºç³»ç»Ÿæ¼”ç¤ºdemoï¼ŒåŸºäº **Spring Boot 3**ã€**Web3j** å’Œ **Ganache** æ„å»ºï¼Œå®ç°å¯ä¿¡æº¯æºä¸Šé“¾ã€‚

> **é¡¹ç›®åœ°å€**: https://github.com/linyshdhhcb/blockchain-traceability-demo.git  
> **ä½œè€…é‚®ç®±**: jingshuihuayue@qq.com  

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§                 | è¯´æ˜                                                         |
| :------------------- | :----------------------------------------------------------- |
| âœ… **å…¨è‡ªåŠ¨åˆçº¦éƒ¨ç½²** | é›†æˆ `deploy-contract.js` è„šæœ¬ï¼Œä¸€é”®è‡ªåŠ¨ç¼–è¯‘ã€éƒ¨ç½² Solidity åˆçº¦åˆ° Ganacheï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚ |
| âœ… **æ™ºèƒ½ç¯å¢ƒæ£€æµ‹**   | `test-deployment.js` å·¥å…·å¯è‡ªåŠ¨æ£€æŸ¥ Node.js ä¾èµ–ã€ç§é’¥æ ¼å¼ã€ç½‘ç»œè¿æ¥ã€åˆçº¦æ–‡ä»¶å®Œæ•´æ€§ã€‚ |
| âœ… **åç«¯æœåŠ¡**       | åŸºäº Spring Boot 3 çš„ Java åç«¯ï¼Œæä¾›ç¨³å®šã€å®‰å…¨çš„ RESTful API æ¥å£ã€‚ |
| âœ… **ç®€å•APIæ¥å£**    | æä¾› `add`, `get`, `count`, `status`, `health` ç­‰æ ‡å‡†æ¥å£ï¼Œæ˜“äºå‰ç«¯é›†æˆã€‚ |
| âœ… **é…ç½®å³ç”¨**       | æ‰€æœ‰é…ç½®æ¸…æ™°æ˜äº†ï¼Œ`contract-deployment.json` è‡ªåŠ¨è®°å½•éƒ¨ç½²è¯¦æƒ…ï¼Œé¿å…æ‰‹åŠ¨å¤åˆ¶ç²˜è´´é”™è¯¯ã€‚ |

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| æŠ€æœ¯               | ç‰ˆæœ¬              | è¯´æ˜                             |
| :----------------- | :---------------- | :------------------------------- |
| **Java / JVM**     | JDK 17            | ç¨³å®šçš„è¿è¡Œæ—¶ç¯å¢ƒ                 |
| **Web Framework**  | Spring Boot 3.2.5 | ä¼ä¸šçº§å¾®æœåŠ¡æ¡†æ¶                 |
| **Blockchain SDK** | Web3j 4.8.7       | *é™çº§è‡³ç¨³å®šç‰ˆä»¥å…¼å®¹ Ganache*     |
| **æœ¬åœ°æµ‹è¯•é“¾**     | Ganache CLI / GUI | æœ€æ–°ç‰ˆï¼Œæ¨¡æ‹Ÿä»¥å¤ªåŠç½‘ç»œ           |
| **æ„å»ºå·¥å…·**       | Maven 3.6+        | é¡¹ç›®ä¾èµ–ç®¡ç†å’Œæ‰“åŒ…               |
| **åˆçº¦è¯­è¨€**       | Solidity ^0.8.0   | ç¼–å†™ `Traceability.sol` æ™ºèƒ½åˆçº¦ |
| **æµ‹è¯•æ¡†æ¶**       | JUnit 5           | å•å…ƒä¸é›†æˆæµ‹è¯•                   |
| **ä»£ç ç”Ÿæˆ**       | Lombok            | å‡å°‘æ ·æ¿ä»£ç                      |

## ğŸš€ å¿«é€Ÿå¼€å§‹ (æ¨èä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬)

æœ¬é¡¹ç›®çš„æ ¸å¿ƒäº®ç‚¹æ˜¯**è‡ªåŠ¨åŒ–éƒ¨ç½²**ã€‚æˆ‘å¼ºçƒˆæ¨èæ‚¨ä½¿ç”¨ `deploy-contract.js` è„šæœ¬ï¼Œè€Œéæ‰‹åŠ¨é€šè¿‡ Remix IDEã€‚

### 1ï¸âƒ£ ç¯å¢ƒå‡†å¤‡

**å®‰è£… JDK 17**
```bash
java -version
# åº”è¾“å‡º: openjdk version "17.x.x"
```

**å®‰è£…å¹¶å¯åŠ¨ Ganache**
*   **æ¨èæ–¹å¼ (GUI)**: [ä¸‹è½½ Ganache](https://trufflesuite.com/ganache/) å¹¶å¯åŠ¨ã€‚ç¡®ä¿ RPC æœåŠ¡å™¨ä¸º `http://127.0.0.1:7545`ã€‚
*   **å‘½ä»¤è¡Œæ–¹å¼**:
    
    ```bash
    npm install -g ganache-cli
    ganache-cli -p 7545 -h 0.0.0.0
    ```
    > ğŸ’¡ **æ³¨æ„**: é»˜è®¤è´¦æˆ·æ‹¥æœ‰ 100 ETH æµ‹è¯•å¸ï¼Œç¡®ä¿å…¶å¯ç”¨ã€‚

### 2ï¸âƒ£ å®‰è£… Node.js ä¾èµ– & æµ‹è¯•ç¯å¢ƒ

#### æ–¹æ³•ä¸€ï¼šè„šæœ¬

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š
```bash
# è¿›å…¥è„šæœ¬ç›®å½•
cd ./deploy-contract

# å®‰è£…éƒ¨ç½²è„šæœ¬æ‰€éœ€ä¾èµ–
npm install web3 solc

# è¿è¡Œç¯å¢ƒæµ‹è¯•å·¥å…·ï¼ˆå¼ºçƒˆå»ºè®®å…ˆæ‰§è¡Œï¼ï¼‰
npm run test-env
```
`test-env` ä¼šæ£€æŸ¥ä½ çš„ Node.js ç¯å¢ƒã€ä¾èµ–ã€ç§é’¥é…ç½®å’Œç½‘ç»œè¿æ¥ï¼Œæå‰å‘ç°é—®é¢˜ã€‚

### 3ï¸âƒ£ é…ç½®å¹¶éƒ¨ç½²æ™ºèƒ½åˆçº¦ (æ ¸å¿ƒæ­¥éª¤!)

**ç¼–è¾‘ `deploy-contract.js`**
æ‰“å¼€ `deploy-contract.js` æ–‡ä»¶ï¼Œæ‰¾åˆ°ä»¥ä¸‹é…ç½®é¡¹ï¼š

```javascript
const PRIVATE_KEY = "0xä½ çš„ç§é’¥"; // ğŸ”´ æ›¿æ¢ä¸ºä½ çš„Ganacheç§é’¥
// å…¶ä»–å‚æ•°ä¿æŒé»˜è®¤æˆ–æŒ‰éœ€è°ƒæ•´
```

**è·å– Ganache ç§é’¥**:

1.  æ‰“å¼€ Ganache GUIã€‚
2.  ç‚¹å‡»ä»»æ„è´¦æˆ·å³ä¾§çš„ ğŸ”‘ å›¾æ ‡ã€‚
3.  å¤åˆ¶æ˜¾ç¤ºçš„ç§é’¥ï¼ˆæ ¼å¼ï¼š`0x123abc...`ï¼‰ã€‚
4.  å°†å…¶ç²˜è´´æ›¿æ¢ `deploy-contract.js` ä¸­çš„ `PRIVATE_KEY`ã€‚

**è¿è¡Œéƒ¨ç½²è„šæœ¬**
```bash
# ä½¿ç”¨ npm è„šæœ¬ï¼ˆæ¨èï¼‰
npm run deploy

# æˆ–ç›´æ¥è¿è¡Œ
node deploy-contract.js
```

**ğŸ‰ éƒ¨ç½²æˆåŠŸï¼**
æ‚¨å°†çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹è¾“å‡ºï¼š
```
ğŸš€ å¼€å§‹éƒ¨ç½²æ™ºèƒ½åˆçº¦...
==================================================
ğŸŒ è¿æ¥åˆ°åŒºå—é“¾ç½‘ç»œ: http://127.0.0.1:7545
âœ… ç½‘ç»œè¿æ¥æˆåŠŸï¼Œç½‘ç»œID: 5777
ğŸ‘¤ ä½¿ç”¨è´¦æˆ·: 0x742d35Cc6634C0532925a3b8D404d3aABe5475cc
ğŸ’° è´¦æˆ·ä½™é¢: 99.99 ETH
ğŸ“ å¼€å§‹ç¼–è¯‘æ™ºèƒ½åˆçº¦...
âœ… åˆçº¦ç¼–è¯‘æˆåŠŸ
ğŸš€ å¼€å§‹éƒ¨ç½²åˆçº¦...
â›½ é¢„ä¼°Gasè´¹ç”¨: 572258
==================================================
ğŸ‰ åˆçº¦éƒ¨ç½²æˆåŠŸï¼
ğŸ“ åˆçº¦åœ°å€: 0x3bD5D66147a59F8F4f5832dAbcf64aaD05424a26
ğŸ”— äº¤æ˜“å“ˆå¸Œ: 0xabcdef1234567890abcdef1234567890abcdef12
â›½ å®é™…Gasä½¿ç”¨: 572258
==================================================
ğŸ’¾ éƒ¨ç½²ä¿¡æ¯å·²ä¿å­˜åˆ° contract-deployment.json
å†…å®¹ï¼š
{
  "contractAddress": "0x1234567890123456789012345678901234567890",
  "transactionHash": "0xabcdef1234567890abcdef1234567890abcdef12",
  "gasUsed": 1234567,
  "deployTime": "2023-09-14T10:00:00.000Z",
  "networkId": "5777",
  "deployer": "0x742d35Cc6634C0532925a3b8D404d3aABe5475cc"
}
```

> âœ… **å…³é”®ä¿¡æ¯**: **è¯·åŠ¡å¿…å¤åˆ¶ `åˆçº¦åœ°å€` (`0x3bD5D66147a59F8F4f5832dAbcf64aaD05424a26`) å’Œ `ç§é’¥`**ã€‚

#### æ–¹æ³•äºŒï¼šRemix IDE

##### æ‰“å¼€ Remix IDE

è®¿é—®ï¼šhttps://remix.ethereum.org/

#####  åˆ›å»ºåˆçº¦æ–‡ä»¶

1. ç‚¹å‡»å·¦ä¾§æ–‡ä»¶ç®¡ç†å™¨çš„ "+" æŒ‰é’®
2. åˆ›å»ºæ–°æ–‡ä»¶ï¼š`Traceability.sol`
3. å¤åˆ¶ `contracts/Traceability.sol` çš„å®Œæ•´å†…å®¹åˆ°æ–°æ–‡ä»¶

##### ç¼–è¯‘åˆçº¦

1. ç‚¹å‡»å·¦ä¾§çš„ "Solidity Compiler" å›¾æ ‡
2. é€‰æ‹©ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼š`0.8.0+`
3. ç‚¹å‡» "Compile Traceability.sol" æŒ‰é’®
4. ç¡®è®¤ç¼–è¯‘æˆåŠŸï¼ˆç»¿è‰²å‹¾é€‰ï¼‰

##### è¿æ¥ Ganache

1. ç‚¹å‡»å·¦ä¾§çš„ "Deploy & Run Transactions" å›¾æ ‡
2. Environment é€‰æ‹©ï¼š`Web3 Provider`
3. åœ¨å¼¹å‡ºæ¡†ä¸­è¾“å…¥ï¼š`http://127.0.0.1:7545`
4. ç‚¹å‡» "OK" ç¡®è®¤è¿æ¥

##### éƒ¨ç½²åˆçº¦

1. ç¡®è®¤ Contract é€‰æ‹©ä¸ºï¼š`Traceability`
2. ç‚¹å‡» "Deploy" æŒ‰é’®
3. åœ¨ Ganache ä¸­ç¡®è®¤äº¤æ˜“
4. å¤åˆ¶éƒ¨ç½²åçš„åˆçº¦åœ°å€

### 4ï¸âƒ£ é…ç½® SpringBoot åº”ç”¨

ç¼–è¾‘ `src/main/resources/application.yml` æ–‡ä»¶ï¼Œæ›´æ–°ä»¥ä¸‹ä¸¤é¡¹ï¼š

```yaml
blockchain:
  rpc-url: http://localhost:7545 # Ganache RPCåœ°å€
  contract-address: 0x3bD5D66147a59F8F4f5832dAbcf64aaD05424a26 # ğŸ”´ æ›¿æ¢ä¸ºä¸Šä¸€æ­¥å¤åˆ¶çš„åˆçº¦åœ°å€
  private-key: 0xä½ çš„ç§é’¥ # ğŸ”´ æ›¿æ¢ä¸ºGanacheä¸­çš„å®é™…ç§é’¥

server:
  port: 8088

logging:
  level:
    org.linyi.test: INFO
    org.web3j: WARN
```

### 5ï¸âƒ£ å¯åŠ¨ SpringBoot åº”ç”¨

```bash
# æ¸…ç†å¹¶ç¼–è¯‘
mvn clean compile

# å¯åŠ¨åº”ç”¨
mvn spring-boot:run
```

æˆåŠŸå¯åŠ¨åï¼Œæ§åˆ¶å°ä¼šæ˜¾ç¤ºï¼š
```
Started BlockchainDemoApplication in 1.503 seconds
```

### 6ï¸âƒ£ æµ‹è¯• API æ¥å£

åº”ç”¨å¯åŠ¨åï¼Œå³å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æµ‹è¯•ï¼š

**æ£€æŸ¥è¿æ¥çŠ¶æ€** (æœ€å¸¸ç”¨)
```bash
curl "http://localhost:8088/blockchain/status"
# å“åº”ç¤ºä¾‹: {"connected":true,"success":true,"message":"åŒºå—é“¾è¿æ¥æ­£å¸¸"}
```

**æ·»åŠ ä¸€æ¡æº¯æºè®°å½•**
```bash
curl -X POST "http://localhost:8088/blockchain/add?data=æº¯æºAç”Ÿäº§ä¿¡æ¯"
```

**æŸ¥è¯¢ç‰¹å®šè®°å½•**
```bash
curl "http://localhost:8088/blockchain/get/1"
```

**è·å–è®°å½•æ€»æ•°**
```bash
curl "http://localhost:8088/blockchain/count"
```



## âš ï¸ æ•…éšœæ’é™¤ (å¸¸è§é—®é¢˜)

| é—®é¢˜                                                         | åŸå›                                                | è§£å†³æ–¹æ¡ˆ                                                     |
| :----------------------------------------------------------- | :------------------------------------------------- | :----------------------------------------------------------- |
| **ENS è§£æé”™è¯¯** (`Unable to determine sync status of node`) | Web3j å°è¯•è§£æ Ganache ä¸æ”¯æŒçš„ ENS åç§°ã€‚         | âœ… **å·²è§£å†³**ï¼šé¡¹ç›®å·²é™çº§ Web3j è‡³ 4.8.7 å¹¶å®ç°å»¶è¿ŸåŠ è½½æœºåˆ¶ã€‚åº”ç”¨ä»å¯æ­£å¸¸å¯åŠ¨ã€‚ |
| **"è¯·å…ˆé…ç½®ç§é’¥"**                                           | `deploy-contract.js` ä¸­çš„ `PRIVATE_KEY` æœªè¢«ä¿®æ”¹ã€‚ | æŒ‰ç…§ç¬¬3æ­¥ï¼Œæ­£ç¡®å¡«å†™ Ganache ç§é’¥ã€‚                           |
| **"æ— æ³•è¿æ¥åˆ°åŒºå—é“¾ç½‘ç»œ"**                                   | Ganache æœªè¿è¡Œï¼Œæˆ–ç«¯å£ä¸åŒ¹é…ã€‚                     | å¯åŠ¨ Ganacheï¼Œç¡®è®¤ `RPC_URL` ä¸º `http://127.0.0.1:7545`ã€‚ä½¿ç”¨ `curl http://127.0.0.1:7545` æµ‹è¯•è¿é€šæ€§ã€‚ |
| **"è´¦æˆ·ä½™é¢ä¸è¶³"**                                           | é€‰æ‹©çš„è´¦æˆ·æ²¡æœ‰è¶³å¤Ÿçš„æµ‹è¯•ETHã€‚                      | åœ¨ Ganache ä¸­é€‰æ‹©ä¸€ä¸ªä½™é¢å……è¶³çš„è´¦æˆ·ï¼Œæˆ–é‡å¯ Ganache è·å–æ–°è´¦æˆ·ã€‚ |
| **"åˆçº¦ç¼–è¯‘å¤±è´¥"**                                           | `contracts/Traceability.sol` æ–‡ä»¶æŸåæˆ–è¯­æ³•é”™è¯¯ã€‚  | æ£€æŸ¥è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”å†…å®¹å®Œæ•´ã€‚ä¹Ÿå¯å°è¯•ä½¿ç”¨ Remix IDE ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆã€‚ |
| **"Out of gas"**                                             | Gas é™åˆ¶è®¾ç½®è¿‡ä½ã€‚                                 | åœ¨ `deploy-contract.js` ä¸­å¢åŠ  `GAS_LIMIT` å€¼ï¼Œå¦‚ `8000000`ã€‚ |
| **ä¸­æ–‡ä¹±ç  (PowerShell)**                                    | PowerShell é»˜è®¤ç¼–ç é—®é¢˜ã€‚                          | ä½¿ç”¨è‹±æ–‡ç‰ˆæœ¬çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ–åˆ‡æ¢è‡³ CMD/WSLã€‚                   |

## æ€»ç»“

 æ­¤ä¸º**æ¼”ç¤ºé¡¹ç›®**ï¼Œä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä¹‹ç”¨ã€‚

**å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿è”ç³»ä½œè€…ï¼šjingshuihuayue@qq.com**